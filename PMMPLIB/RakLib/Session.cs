using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Net;

namespace PMMPLIB.RakLib
{
    public class Session
    {
        // # 実装しない一覧
        // >> Sliding Window
        // >> ACK/NACK & Recovery Process(TODO??)

        protected IPEndPoint _endpoint = null;
        public IPEndPoint Server
        {
            get { return _endpoint; }
            set { _endpoint = value; }
        }
        public string ServerIP
        {
            get
            {
                if (_endpoint == null)
                    return null;
                else
                    return _endpoint.Address.ToString();
            }
            set
            {
                if (_endpoint == null)
                    throw new Exception("ポートが設定されていないためIPアドレスを変更することができません。Serverプロパティを設定してください。");
                IPAddress tmp = null;
                _endpoint.Address = IPAddress.Parse(value);
            }
        }
        public int ServerPort
        {
            get
            {
                if (_endpoint == null)
                    throw new Exception("ポートが設定されていません。Serverプロパティから設定してください。");
                return _endpoint.Port;
            }
            set
            {
                if (_endpoint == null)
                    throw new Exception("IPアドレスが設定されていないためポートを変更することができません。Serverプロパティを設定してください。");
                _endpoint.Port = value;
            }
        }

        public int ClientPort { get; set; }

        public long ClientID { get; set; }

        public int MtuSize { get; set; }

        public int MessageIndex { get; set; }
        public int LastReliableIndex { get; set; }
        public int[] ChannelIndex { get; set; }

        public int SendSeqNumber { get; set; }
        public int LastSeqNumber { get; set; }

        //TODO: Split系プロパティの追加

        public Session()
        {
            MtuSize = 1465;

            MessageIndex = 0;
            LastReliableIndex = -1;
            ChannelIndex = new int[32];

            SendSeqNumber = 0;
            LastSeqNumber = -1;
        }

        //TODO: プロパティ自動更新用のパケット処理関数を実装(ソケットを手元に置いておく必要が出てくるかも)
    }
}
